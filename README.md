# IATI Refresher
Application to download IATI data as presented by the IATI registry, store and track changes in the source files, and store the normalised data in a compressed and performant SQL database.

# Local setup
```
docker build .
```

# Local testing
```
docker run --env-file=.env IMAGE_NAME
```

# DB Migrations

Database migrations are handled using Alembic - https://alembic.sqlalchemy.org/

Refer to its fine documentation, and then when making migrations change the autogenerated revision name to reflect the version to which it relates, following the convention - ie for version 0.3.1, change it to BR_0_3_1_whatever_message.py

# Environment Variables

These are required:# IATI Serverless Refresher
2
​
3
Serverless service based on the IATI Better Refresher
4
​
5
# Docker
6
​
7
# Local Docker setup
8
​
9
```
10
docker build .
11
```
12
​
13
# Local Docker testing
14
​
15
```
16
docker run --env-file=.env IMAGE_NAME
17
```
18
​
19
# Local Machine Set Up
20
​
21
## Prerequisities
22
​
23
- Python 3
24
- PostgreSQL (version 12)
25
  - psycopg2 does not work with v13
26
​
27
## Create Database
28
​
29
- Creates a database called `refresher` owned by `refresh`
30
  `createdb refresher -O refresh`
31
​
32
## Environment Variables
33
​
34
These are required:
35
​
36
### AZURE_STORAGE_CONNECTION_STRING
37
​
38
- This can be found in the Storage Account > Access Keys or by running `az storage account show-connection-string -g MyResourceGroup -n MyStorageAccount`
39
​
40
### AZURE_STORAGE_CONTAINER_SOURCE
41
​
42
- The string name of your blob container in Azure E.g. fun-blob-1
43
​
44
### DB_CONNECTION_STRING
45


AZURE_STORAGE_CONNECTION_STRING
AZURE_STORAGE_CONTAINER_SOURCE
DB_CONNECTION_STRING
